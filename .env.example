# MimiVibe Backend Environment Variables
# Copy this file to .env.local and fill in your actual values
# WARNING: Never commit .env.local to git repository

# ==========================================
# Environment Configuration
# ==========================================
ENVIRONMENT=development
# Options: development, staging, production

RUST_LOG=debug,mimi_r_backend=debug,axum=debug
# Options: trace, debug, info, warn, error

# ==========================================
# Authentication & API Keys (Phase 1)
# ==========================================

# Internal API Keys (development)
TTRT_DEV_API_KEY=ttrt_dev_a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6

# Internal API Keys (staging)
TTRT_STAGING_API_KEY=ttrt_staging_b7c8d9e0f1g2h3i4j5k6l7m8n9o0p1q2

# Internal API Keys (production)
TTRT_PROD_API_KEY=ttrt_prod_h3i4j5k6l7m8n9o0p1q2r3s4t5u6v7w8

# Default API Key (fallback)
API_KEY_DEFAULT=${TTRT_DEV_API_KEY}

# Rate limiting configuration
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW_MINUTES=1

# ==========================================
# Google Gemini LLM Configuration
# ==========================================

# Google Gemini API Key (required for tarot readings)
GEMINI_API_KEY=your-google-gemini-api-key-here
GEMINI_MODEL=gemini-pro
GEMINI_API_TIMEOUT_SECS=30

# ==========================================
# Prompt Security & IP Protection
# ==========================================

# Option 1: Base64-encoded prompts (development)
# Encode prompts: echo "Your prompt here" | base64
PROMPT_QUESTION_FILTER=BASE64_ENCODED_QUESTION_FILTER_PROMPT
PROMPT_QUESTION_ANALYSIS=BASE64_ENCODED_QUESTION_ANALYSIS_PROMPT
PROMPT_READING_AGENT=BASE64_ENCODED_READING_AGENT_PROMPT

# Option 2: Remote prompt service (recommended for production)
PROMPT_SERVICE_URL=https://api.mimivibe.com/prompts
PROMPT_API_KEY=your_secure_prompt_api_key

# ==========================================
# Database Configuration (Supabase PostgreSQL)
# ==========================================

# Primary database connection string
DATABASE_URL=postgresql://postgres:your-password@db.your-project-ref.supabase.co:5432/postgres

# Direct database URL (for migrations, if needed)
DIRECT_URL=postgresql://postgres:your-password@db.your-project-ref.supabase.co:5432/postgres

# Database pool settings
DATABASE_POOL_SIZE=20
DATABASE_MIN_CONNECTIONS=5
DATABASE_ACQUIRE_TIMEOUT_SECS=30

# ==========================================
# Payment Gateway (Stripe)
# ==========================================

# Stripe API Keys
STRIPE_SECRET_KEY=sk_test_or_sk_live_your-stripe-secret-key
STRIPE_PUBLIC_KEY=pk_test_or_pk_live_your-stripe-public-key

# Stripe Webhook Configuration
STRIPE_WEBHOOK_SECRET=whsec_test_or_whsec_live_your-webhook-secret
STRIPE_WEBHOOK_SIGNING_SECRET=your-webhook-signing-secret

# Stripe Settings
STRIPE_API_VERSION=2023-10-16

# ==========================================
# Payment Configuration
# ==========================================

# Currency settings
DEFAULT_CURRENCY=THB

# Star package configuration
STARTER_STARS=5
STARTER_PRICE=5000

BASIC_STARS=15
BASIC_PRICE=13000
BASIC_BONUS_STARS=2

PREMIUM_STARS=35
PREMIUM_PRICE=28000
PREMIUM_BONUS_STARS=5

# Coin exchange configuration
COIN_TO_STAR_RATIO=10
# 10 Coins = 1 Star

# Random reward range for invites (percentage)
REWARD_RANDOM_MIN_PERCENTAGE=30
REWARD_RANDOM_MAX_PERCENTAGE=50

# Invite system configuration
MAX_DAILY_INVITES=10
INVITE_EXPIRY_DAYS=30
INVITE_COIN_MIN=3
INVITE_COIN_MAX=5

# User tier configuration
BRONZE_INVITE_THRESHOLD=0
SILVER_INVITE_THRESHOLD=6
GOLD_INVITE_THRESHOLD=16

BRONZE_REWARD_MIN=3
BRONZE_REWARD_MAX=5

SILVER_REWARD_MIN=4
SILVER_REWARD_MAX=6
SILVER_REWARD_BONUS_PERCENTAGE=20

GOLD_REWARD_MIN=5
GOLD_REWARD_MAX=8
GOLD_REWARD_BONUS_PERCENTAGE=50

# ==========================================
# Authentication Providers (Multi-Provider)
# ==========================================

# Clerk Authentication
CLERK_ISSUER=https://your-domain.clerk.accounts.dev
CLERK_AUDIENCE=your-app-id
CLERK_JWKS_URL=https://your-domain.clerk.accounts.dev/v1/jwks
CLERK_ENABLED=false

# Auth0 Authentication
AUTH0_ISSUER=https://your-domain.auth0.com
AUTH0_AUDIENCE=your-api-identifier
AUTH0_JWKS_URL=https://your-domain.auth0.com/.well-known/jwks.json
AUTH0_ENABLED=false

# Firebase Authentication
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_PRIVATE_KEY_ID=your-private-key-id
FIREBASE_PRIVATE_KEY=your-private-key
FIREBASE_CLIENT_EMAIL=your-client-email
FIREBASE_CLIENT_ID=your-client-id
FIREBASE_CLIENT_X509_CERT_URL=your-cert-url
FIREBASE_ENABLED=false

# Custom/Internal Authentication
CUSTOM_AUTH_ENABLED=true
CUSTOM_JWT_SECRET=your-custom-jwt-secret-key-min-32-chars
CUSTOM_JWT_ISSUER=mimivibe-backend
CUSTOM_JWT_AUDIENCE=mimivibe-frontend
CUSTOM_JWT_EXPIRATION_HOURS=24

# ==========================================
# Application Configuration
# ==========================================

# Server configuration
SERVER_HOST=0.0.0.0
SERVER_PORT=3000
SERVER_WORKERS=4

# CORS configuration
CORS_ORIGIN=http://localhost:3000,http://localhost:3001,https://mimivibe.com

# Security headers
SECURE_HEADERS_ENABLED=true
SECURITY_HEADER_HSTS_MAX_AGE=31536000

# ==========================================
# Observability & Monitoring
# ==========================================

# Sentry Error Tracking (MVP recommendation)
SENTRY_DSN=https://your-sentry-key@sentry.io/your-project-id
SENTRY_ENABLED=true
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# Health check endpoints
HEALTH_CHECK_ENABLED=true
METRICS_ENDPOINT_ENABLED=false

# ==========================================
# Redis Configuration (Future: Queue System)
# ==========================================

# Upstash Redis Streams (for job queue in Phase 2)
UPSTASH_REDIS_URL=https://your-user:your-password@your-region-upstash-io
UPSTASH_REDIS_TOKEN=your-upstash-redis-token

# Redis queue configuration
REDIS_STREAM_NAME=jobs:stream
REDIS_CONSUMER_GROUP=jobs:group
REDIS_CONSUMER_NAME=worker-1

# Job processing
JOB_MAX_ATTEMPTS=5
JOB_BASE_BACKOFF_SECS=2
JOB_MAX_BACKOFF_SECS=60
JOB_VISIBILITY_TIMEOUT_SECS=60

# ==========================================
# LLM Configuration & Agent Settings
# ==========================================

# LangChain Rust integration
LANGCHAIN_TIMEOUT_SECS=30
LANGCHAIN_MAX_RETRIES=3

# Agent pipeline configuration
AGENT_QUESTION_FILTER_ENABLED=true
AGENT_QUESTION_ANALYZER_ENABLED=true
AGENT_READING_ENGINE_ENABLED=true

# Random card selection
RANDOM_CARD_SEED=
# Leave empty for true randomness, or set seed for deterministic testing

# Card count probability (3 vs 5 cards)
CARD_COUNT_3_PROBABILITY=0.5
CARD_COUNT_5_PROBABILITY=0.5

# Input validation
MIN_QUESTION_LENGTH=8
MAX_QUESTION_LENGTH=180

# ==========================================
# File Storage Configuration
# ==========================================

# Supabase Storage settings
SUPABASE_URL=https://your-project-ref.supabase.co
SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key

# Storage buckets
STORAGE_BUCKET_TAROT_IMAGES=tarot-images
STORAGE_BUCKET_USER_PROFILES=user-profiles

# File upload limits
MAX_FILE_SIZE_MB=5
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png,webp

# ==========================================
# Feature Flags
# ==========================================

# Feature toggle configuration
FEATURE_TAROT_READING=true
FEATURE_PAYMENT_PROCESSING=true
FEATURE_USER_INVITES=true
FEATURE_ADMIN_DASHBOARD=true
FEATURE_ANALYTICS=true

# Beta features
FEATURE_VOICE_INPUT=false
FEATURE_LIVE_CHAT=false
FEATURE_ADVANCED_SPREADS=false

# ==========================================
# Logging & Debugging
# ==========================================

# Detailed logging options
LOG_REQUEST_BODY=false
LOG_RESPONSE_BODY=false
LOG_DATABASE_QUERIES=false
LOG_STRIPE_REQUESTS=false
LOG_GEMINI_REQUESTS=false

# Performance monitoring
ENABLE_PERFORMANCE_TRACING=true
SLOW_REQUEST_THRESHOLD_MS=1000

# ==========================================
# External Services (Future Integrations)
# ==========================================

# Email service (for notifications, future)
EMAIL_SERVICE=sendgrid
SENDGRID_API_KEY=your-sendgrid-api-key

# SMS service (for 2FA, future)
SMS_SERVICE=twilio
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token

# Analytics service
ANALYTICS_SERVICE=mixpanel
ANALYTICS_TOKEN=your-analytics-token

# ==========================================
# Development Tools & Testing
# ==========================================

# Testing configuration
TEST_DATABASE_URL=postgresql://postgres:password@localhost:5432/mimivibe_test
TEST_MODE=false

# Mock external services for testing
MOCK_GEMINI_RESPONSES=false
MOCK_STRIPE_PAYMENTS=false
MOCK_EMAIL_SENDING=false

# Development helpers
PRINT_SQL_QUERIES=false
ALLOW_LOCALHOST_CORS=true
DEVELOPMENT_MODE=true

# ==========================================
# Notes
# ==========================================

# IMPORTANT SECURITY NOTES:
# 1. Never commit .env.local to git - add it to .gitignore
# 2. Use separate keys for dev, staging, and production environments
# 3. Rotate API keys regularly
# 4. Use strong random values for secrets (min 32 characters)
# 5. Store sensitive data in platform-provided secret managers for production
#    (AWS Secrets Manager, Google Secret Manager, Vercel Secrets, etc.)
#
# ENVIRONMENT-SPECIFIC SETUP:
#
# Development (.env.local):
# - Use test/free tier API keys
# - Enable debug logging
# - Use localhost CORS
# - Mock external services if needed
#
# Staging (.env.staging):
# - Use staging tier API keys
# - Moderate logging
# - Staging domain CORS
# - Real integrations but with limits
#
# Production (.env.production):
# - Use production API keys from secret manager
# - Minimal logging (info level)
# - Production domain CORS only
# - All integrations enabled with rate limits
#
# TESTING PROMPTS (for development):
# Encode with: echo "test prompt" | base64
# Example:
# PROMPT_QUESTION_FILTER=dGVzdCBwcm9tcHQgZm9yIHF1ZXN0aW9uIGZpbHRlcmluZw==
# PROMPT_QUESTION_ANALYSIS=dGVzdCBwcm9tcHQgZm9yIHF1ZXN0aW9uIGFuYWx5c2lz
# PROMPT_READING_AGENT=dGVzdCBwcm9tcHQgZm9yIHRhcm90IHJlYWRpbmdz
